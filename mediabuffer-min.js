/*!  
 *  mediabuffer.js
 *  @version 1.0
 *  @author Kris Noble - http://simianstudios.com
 *  @license MIT 
 */
function Mediabuffer(e,t,r){mbDebug&&console.log("mediabuffer init"),this.element=e,this.progressCallback=t,this.readyCallback=r,this.loadStartTime=0,this.percentBuffered=0,this.previousPercentBuffered=0,this.element.setAttribute("data-vol",this.element.volume),this.element.volume=0,this.element.preload="auto",this.element.load(),this.boundProgress=this.progress.bind(this),this.element.addEventListener("progress",this.boundProgress,!0)}var mbDebug=!0;Mediabuffer.prototype.progress=function(){0===this.loadStartTime&&(this.loadStartTime=(new Date).valueOf());var e=(new Date).valueOf(),t=this.element.buffered.length;if(t>0){var r=this.element.duration,s=this.element.buffered.end(0),i=(e-this.loadStartTime)/1e3,o=i/s,n=r-s,a=n*o;mbDebug&&console.log("mediabuffer d= "+r+" / sL= "+s+" / eT= "+i+" / dR= "+o+" / sTL= "+n+" / eRDS= "+a),(i>0||0===n)&&s>a?(this.destroy(!1),this.readyCallback()):i>0&&(this.percentBuffered=Math.round(s/a*100),this.percentBuffered>this.previousPercentBuffered&&(this.progressCallback(this.percentBuffered),this.previousPercentBuffered=this.percentBuffered),this.chromeBugWorkaround())}},Mediabuffer.prototype.chromeBugWorkaround=function(){this.element.play(),this.element.pause(),this.element.currentTime=0},Mediabuffer.prototype.destroy=function(e){this.element.removeEventListener("progress",this.boundProgress,!0),this.element.volume=this.element.getAttribute("data-vol"),this.element.removeAttribute("data-vol"),e&&(this.element.preload="none",this.element.load())};